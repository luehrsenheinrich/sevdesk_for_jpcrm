<?php
/**
 * A class that handles the base operations for interaction with the sevDesk API.
 *
 * @package sdjpcrm
 */

namespace WpMunich\sdjpcrm\SevDesk;
use \WP_Error;

/**
 * Class SevDeskAPI.
 */
abstract class SevDeskAPI {

	/**
	 * The sevdesk api url.
	 *
	 * @var string
	 */
	protected $api_url = 'https://my.sevdesk.de/api/v1/';

	/**
	 * The sevdesk api token.
	 *
	 * @var string
	 */
	protected $api_token = '';

	/**
	 * Object errors array.
	 *
	 * @var array
	 */
	protected $errors = array();

	/**
	 * Constructor.
	 */
	public function __construct() {
		$this->api_token = get_option( 'sevdesk_api_token' );
	}

	/**
	 * Validates a response generated by the WP HTTP functions.
	 *
	 * @param  object $response The WP HTTP response.
	 *
	 * @return array|object     A data array or WP_Error
	 */
	protected function validate_wp_response( $response ) {
		if ( ! is_wp_error( $response ) ) {
			// The request went through successfully, check the response code against
			// what we're expecting.
			if ( 200 === wp_remote_retrieve_response_code( $response ) ) {
				// Do something with the response.
				$data = array(
					'body'    => wp_remote_retrieve_body( $response ),
					'headers' => wp_remote_retrieve_headers( $response ),
				);
			} else {
				// The response code was not what we were expecting, record the message.
				$data = new WP_Error( 'sevdesk_api_error', wp_remote_retrieve_response_message( $response ) );
			}
		} else {
			// There was an error making the request.
			$data = new WP_Error( 'sevdesk_api_error', $response->get_error_message() );
		}

		return $data;
	}
}
